<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../static/css/styleregalo.css" rel="stylesheet" />
    <title>Regalos</title>
</head>
<body>
    <div class="regalos">
        <div class="img-regalo">
            <img src="{{ url_for('static',filename='image/regalos-sugeridos.png')}}">
        </div>
        
            <div class="caja-de-regalos">
            
                {% for elemento in lista %}
                <div class="caja-exterior-1">
                <div class="caja">
                    <div id="caja-exterior-{{ elemento[3] }}" class="caja-exterior">
                        <div class="caja-interior">
                            <div class="caja-titulo">
                                <div class="tiulo-secundario" id="tiulo-secundario-{{ elemento[3] }}" >
                                    <h6 class="titulo" onclick="AnotarRegalo('{{ elemento[0] }}','caja-exterior-{{ elemento[3] }}')">{{ elemento[0] }}</h6>
                                    <p class="descripcion">{{ elemento[1] }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if elemento[2] %}
                        <a target="_blank" class="btn-referencia" href="{{ elemento[2] }}">VER</a>
                        {% else %}
                            <p target="_blank" class="btn-referencia">VER</p>
                        {% endif %}
                    </div>   
                </div>     
                {% endfor %}
            
        </div>
        <div class="img-regalo-debajo">
            <img src="{{ url_for('static',filename='image/regalos-sugeridos-debajo.png')}}">
        </div>
        <button class="btn-regalar" onclick="enviarRegalos()"> regalar </button>
    </div>
<script>
    var listaDeRegalos = [];

    function AnotarRegalo(nombreRegalo, id) {
        var check = document.getElementById(id);
        if (check.classList.contains('caja-exterior')) {
            check.classList.remove('caja-exterior');
            check.classList.add('caja-exterior-validado');
            listaDeRegalos.push(nombreRegalo);
        } else {
            check.classList.remove('caja-exterior-validado');
            check.classList.add('caja-exterior');
            eliminarRegalo(nombreRegalo);
        }
    }

    function eliminarRegalo(nombre) {
        listaDeRegalos = listaDeRegalos.filter(function(regalo) {
            return regalo !== nombre;
        });
    }

    function enviarRegalos() {
        var xhr = new XMLHttpRequest();
        var url = "/regalar";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        xhr.onreadystatechange = function () {
             if (xhr.readyState === 4 && xhr.status === 200) {
             // Aqu√≠ puedes manejar la respuesta del backend si es necesario
                console.log(xhr.responseText);
                location.reload();
            }
        };

        xhr.send(JSON.stringify({ regalos: listaDeRegalos }));
        }

</script>

</body>
</html>

